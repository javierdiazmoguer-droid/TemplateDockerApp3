# Definir un VirtualHost que escucha en todos los interfaces en el puerto 80 (HTTP)
# Comentario introductorio que explica el propósito general: crear un host virtual HTTP accesible desde Docker

<VirtualHost *:80>
# Abre el bloque de definición del VirtualHost indicando que Apache aceptará peticiones por el puerto 80 desde cualquier interfaz de red del contenedor

    # Nombre del servidor (se sustituye con la variable de entorno MOODLE_SERVER_NAME)
    # Encabezado para el parámetro ServerName
    ServerName ${SERVER_NAME}
# Establece el nombre de dominio que identificará este servicio Apache, usando una variable de entorno inyectada por Docker

    # Email del administrador del servidor
    # Encabezado descriptivo del parámetro ServerAdmin
    ServerAdmin you@${SERVER_NAME}
# Define el correo del responsable del servidor; Apache lo usa en mensajes automáticos y se genera dinámicamente con el nombre del host

    # Directorio raíz donde se encuentran los archivos de la aplicación
    # Comentario previo al parámetro DocumentRoot
    DocumentRoot "${FOLDER_NAME}"
# Fija la carpeta del filesystem virtualizado que actuará como raíz web desde la que Apache leerá la aplicación PHP

    # Configuración del directorio raíz
    # Encabezado para la sección <Directory>
    <Directory "${FOLDER_NAME}">
# Inicia la configuración de permisos y opciones para el directorio físico que contiene el código de la app dentro del contenedor

        # Permitir listar índices y seguir enlaces simbólicos
        # Comentario introductorio del parámetro Options
        Options Indexes FollowSymLinks
# Habilita que Apache muestre listados de archivos cuando no haya índice y permite resolver symlinks en volúmenes Docker

        # Permitir sobrescribir configuración con archivos .htaccess
        # Encabezado del parámetro AllowOverride
        AllowOverride All
# Autoriza que la aplicación incluya reglas propias mediante .htaccess, algo común en proyectos tipo Moodle

        # Permitir acceso a todos
        # Comentario introductorio de Require
        Require all granted
# Concede acceso HTTP a cualquier cliente que llegue al contenedor, permitiendo pruebas desde el navegador del alumno

        # Denegar acceso a archivos de configuración y control de versiones
        # Encabezado del bloque FilesMatch
        <FilesMatch "^\.(htaccess|htpasswd|ini|php|git)$">
# Abre una regla de coincidencia por expresión regular para archivos ocultos o sensibles

            Require all denied
# Ordena a Apache denegar el acceso directo a esos ficheros para mejorar la seguridad dentro del host virtualizado

        </FilesMatch>
# Cierra la regla de protección de archivos sensibles

    </Directory>
# Cierra la configuración del directorio raíz del VirtualHost

    # Archivos índice por defecto (en orden de prioridad)
    # Comentario previo a DirectoryIndex
    DirectoryIndex index.php index.html info.php
# Define qué archivos se considerarán página inicial cuando el cliente acceda a la raíz del servicio

    # Archivos de registro
    # Encabezado del parámetro ErrorLog
    ErrorLog /var/log/apache2/error_${SERVER_NAME}.log 
# Establece la ruta dentro del contenedor donde se guardarán errores específicos de este VirtualHost

    # Encabezado del parámetro CustomLog
    CustomLog /var/log/apache2/access_${SERVER_NAME}.log combined
# Define el fichero donde se almacenarán accesos HTTP usando el formato combinado estándar de Apache

    # Cierre de la configuración del VirtualHost
    # Comentario final descriptivo

</VirtualHost>
# Cierra definitivamente el bloque del VirtualHost completando la configuración del host virtual Docker
